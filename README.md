# CloudBunch



## Идея
### CloudBunch - иерархическая *State machine*, в которой каждый слой иерархии находится в отдельном микросервисе.

Собственно основная идея состоит в том, 
что многие интерактивные приложения это 
определенная, часто разветвленная последовательность 
вопросов и ответов, 
причем вопросы задает приложение, а отвечает на них 
клиент.

Для формального описания подобных последовательностей
удобно и целесообразно использовать *State machine* (SM), 
для больших и разветвленных - иерархическую *State machine* (HSM).
Иногда их также называют *Flow machine*.

Раз уже речь зашла о больших и разветвленных приложениях и их 
декомпозиции, имеет смысл говорить и о декомпозиции процесса их 
разработки. Было бы неплохо раздать командам разработчиков 
отдельные фичи нашего приложения



### Как это может быть организовано?



Router хранит стек открытых в контексте сессии 
клиента сервисов вместе с их текущими состояниями. 
На верху стека находится активный в данный момент 
сервис.

Все запросы от клиента поступают на Router. Router перенаправляет их на активный сервис.

Открытие (вызов) нового слоя осуществляется ответом от сервиса роутеру (тип OPEN). 
Когда активный сервис закрывается, его результат перенаправляется опять-же через роутер на вызывающий сервис. 

#### Схема прохождения обычного запроса

<img src="schema1.png">

В первом варианте - сессия и состояние отсутствуют, открывапется первый слой , сервис по умолчанию.

Во втором варианте состояние присутствует, запрос направляется в активный сервис

### Схема взаимодействия между сервисами (оекрытие нового слоя, возврат на предыдущий слой)

<img src="schema2.png">